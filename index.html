<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>Caf√© App - Premium UI</title>

  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#f0f0f3">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <link rel="icon" href="assets/logo.png" type="image/png">

  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css">
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

  <style>
    /* --- ESTILOS NEUM√ìRFICOS --- */
    .mesa-status-card {
      background: linear-gradient(145deg, #ffffff, #f0f0f3);
      border-radius: 20px;
      padding: 15px;
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 20px;
      box-shadow: 5px 5px 15px #d1d9e6, -5px -5px 15px #ffffff;
      border: 1px solid rgba(255,255,255,0.5);
    }

    .mesa-icon-box {
      width: 50px; height: 50px;
      background: #000;
      border-radius: 15px;
      display: flex; align-items: center; justify-content: center;
      font-size: 24px; color: white;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }

    .mesa-info h3 { margin: 0; font-size: 16px; color: #333; font-weight: 800; }
    .mesa-info p { margin: 0; font-size: 12px; color: #888; }
    .mesa-indicator { margin-left: auto; width: 12px; height: 12px; border-radius: 50%; }

    .info-box-neumorph {
      background: #f0f0f3;
      border-radius: 15px;
      padding: 15px;
      box-shadow: inset 2px 2px 5px #d1d9e6, inset -2px -2px 5px #ffffff;
    }

    .btn-ver-mas {
      background: #000;
      color: #fff;
      border: none;
      padding: 15px;
      border-radius: 15px;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.2s;
      width: 100%;
    }
    .btn-ver-mas:active { transform: scale(0.98); }

    .header-search-fav {
      padding: 15px 20px;
      background: #f0f0f3;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .menu-carousel::-webkit-scrollbar { display: none; }
    .menu-carousel { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body>

  <div id="splash-screen">
    <div class="splash-content">
      <div class="splash-logo">
        <div style="font-size: 60px; animation: pulse 2s infinite;">üçΩÔ∏è</div>
      </div>
      <div class="loader-dots">
        <span>‚óè</span><span>‚óè</span><span>‚óè</span>
      </div>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-header">
      <img id="user-photo" src="https://picsum.photos/200" alt="Foto de perfil">
      <h3 id="user-name">Cargando...</h3>
      <small>Cliente Preferencial</small>
      <div class="sidebar-buttons">
        <button onclick="window.location.href='perfil.html'">üë§ Perfil</button>
        <button onclick="window.location.href='ajustes.html'">‚öôÔ∏è Ajustes</button>
      </div>
    </div>
    <button class="logout" onclick="cerrarSesionSidebar()">Cerrar Sesi√≥n</button>
  </aside>

  <div id="overlay" class="overlay" onclick="toggleMenu()"></div>

  <div id="view-mapa" class="view">
    <header class="header">
      <div class="top-bar">
        <div class="menu-icon" onclick="toggleMenu()">‚ò∞</div>
        <div class="search-container">
          <span>üîç</span>
          <input type="text" id="search-input-map" placeholder="Buscar antojito o lugar...">
        </div>
      </div>

      <div class="filter-wrapper">
        <div class="filter-chips">
          <button class="chip active" onclick="filtrarPorChip('Todos', this)">Todos</button>
          <button class="chip" onclick="filtrarPorChip('Restaurante', this)">üçΩÔ∏è Restaurante</button>
          <button class="chip" onclick="filtrarPorChip('Cafeteria', this)">‚òï Cafeteria</button>
          <button class="chip" onclick="filtrarPorChip('Bar', this)">üçª Bar</button>
          <button class="chip" onclick="filtrarPorChip('Pizza', this)">üçï Pizza</button>
          <button class="chip" onclick="filtrarPorChip('Tacos', this)">üåÆ Tacos</button>
          <button class="chip" onclick="filtrarPorChip('Postres', this)">üç© Postres</button>
        </div>
      </div>
    </header>

    <main id="map-container">
      <div id="map"></div>
      <div id="preview-card" class="preview-card hidden">
        <div class="preview-content">
            <img id="preview-img" src="" alt="Restaurante" style="object-fit: cover;"> 
            <div class="preview-info">
                <h3 id="preview-nombre">Nombre</h3>
                <p id="preview-cat">Categor√≠a e Horario</p>
            </div>
        </div>
        <div style="display: flex; gap: 10px; margin-top: 10px;">
             <button class="btn-ver-mas" id="btn-abrir-detalle" style="flex: 2;">Ver detalles</button>
             <button class="btn-ver-mas" id="btn-ir-ahora" style="flex: 1; background: #25D366;">üìç Ir</button>
        </div>
      </div>
    </main>
  </div>

  <div id="view-favoritos" class="view hidden">
    <div class="header-search-fav">
      <h1 style="margin: 0 0 15px 0; font-size: 24px;">‚≠ê Favoritos</h1>
      <div class="search-container">
        <span>üîç</span>
        <input type="text" id="search-input-fav" placeholder="Buscar en mis guardados...">
      </div>
    </div>
    <main class="grid-favoritos" id="grid-favoritos" style="padding: 20px;"></main>
  </div>

  <div id="view-detalle" class="view hidden">
    <header class="header-detalle">
      <button class="btn-back" onclick="regresarVistas()">‚Üê</button>
      <h2 id="detalle-titulo-header" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">Cargando...</h2>
    </header>
    
    <main class="detalle-content">
      <div class="card-restaurante-detalle">
        <div style="position: relative; width: 100%; height: 250px; overflow: visible;">
          <img id="detalle-img" src="" alt="Portada" style="width: 100%; height: 100%; object-fit: cover; border-radius: 0 0 25px 25px;">
          <img id="detalle-logo-restaurante" src="" 
               style="position: absolute; bottom: -40px; right: 20px; width: 90px; height: 90px; 
                      border-radius: 50%; border: 5px solid #f0f0f3; box-shadow: 0 10px 20px rgba(0,0,0,0.15); 
                      background: white; object-fit: contain; z-index: 10;">
        </div>
        
        <div class="detalle-body" style="padding: 50px 20px 20px 20px;">
          <h1 id="detalle-nombre" style="font-size: 26px; margin: 0; line-height: 1.2;">Nombre</h1>
          <p id="detalle-categoria" style="color: #888; margin: 5px 0 25px 0; font-size: 14px;">Categor√≠a</p>
          <div id="detalle-info-box"></div>
        </div>
      </div>
    </main>
  </div>

  <nav class="bottom-nav">
    <div class="nav-item active" id="btn-mapa" onclick="cambiarVista('mapa')">
      <span class="icon">üó∫Ô∏è</span>
      <span>Mapa</span>
    </div>
    <div class="nav-item" id="btn-favoritos" onclick="cambiarVista('favoritos')">
      <span class="icon">‚≠ê</span>
      <span>Favoritos</span>
    </div>
  </nav>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>

  <script>
    // 1. Configuraci√≥n de Supabase
    const supabaseUrl = 'https://cpveuexgxwxjejurtwro.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNwdmV1ZXhneHd4amVqdXJ0d3JvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY2MTYxMzAsImV4cCI6MjA4MjE5MjEzMH0.I4FeC3dmtOXNqLWA-tRgxAb7JCe13HysOkqMGkXaUUc';
    window.supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

   // --- BUSCA Y BORRA ESTO EN TU INDEX.HTML ---
async function checkSession() {
  const { data: { session } } = await window.supabase.auth.getSession();
  if (!session) {
    window.location.href = 'login.html'; // <--- ESTO ES LO QUE TE MANDA AL LOGIN SIEMPRE
  }
}
checkSession();
    // 3. Funciones de Interfaz
    function toggleMenu() {
      document.getElementById('sidebar').classList.toggle('active');
      document.getElementById('overlay').classList.toggle('active');
    }

    async function cerrarSesionSidebar() {
      if (confirm("¬øEst√°s seguro de que quieres salir?")) {
        await window.supabase.auth.signOut();
        window.location.href = 'login.html'; // Redirige al login despu√©s de cerrar sesi√≥n
      }
    }

    function filtrarPorChip(cat, btn) {
      document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
      btn.classList.add('active');
      const input = document.getElementById('search-input-map');
      input.value = (cat === 'Todos') ? '' : cat;
      input.dispatchEvent(new Event('input'));
    }
  </script>

  <script src="js/app.js"></script>
</body>
</html>